# vim: set fileencoding=UTF-8 :
# vim:filetype=python

import os
import process_delta_geog as geo
import gis

Import('*')

# Import delta shapefile and regroup from polygons to multipolygons by delta
for experiment, config in experiments.iteritems():
    env.Command(
            target=config['deltas'],
            source='/Users/ztessler/data/deltas/global_map_shp/global_map.shp',
            action=geo.group_delta_shps,
            )

    env.Command(
            source=config['deltas'],
            target=config['delta_areas'],
            action=geo.calc_delta_areas)

    # import ipdb;ipdb.set_trace()
    for delta in deltas:
        env.Command(
                target=config['delta_map'].format(delta=delta),
                source=config['deltas'],
                action=geo.delta_geojson,
                delta=delta)

    env.Command(
            source=[config['deltas'],
                    config['basins_rast'].format(ver='',ext='tif')],
            target=config['basin_ids'],
            action=geo.contributing_basins)

    env.Command(
            source=[config['basins'].format(ver='', ext='pd'),
                    config['discharge_rast'].format(ver='', ext='tif'),
                    config['basin_ids']],
            target=config['basin_mouths'].format(ver='', ext='pd'),
            action=geo.locate_basin_mouths)

    env.Command(
            source=config['basins_rast'].format(ver='',ext='tif'),
            target=config['basin_pixel_areas'],
            action=gis.raster_pixel_areas)

    env.Command(
            source=[config['national_borders_vect'],
                    config['per_capita_gdp_table'],
                    config['basins_rast'].format(ver='',ext='tif')],
            target=config['per_capita_gdp_rast'].format(ver='', ext='tif'),
            action=geo.rasterize_gnp)
