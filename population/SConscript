# vim: set fileencoding=UTF-8 :
# vim:filetype=python

import os
import process_population as pp
import gis

Import('*')

for experiment, config in experiments.iteritems():
    if config['pop_dens_source'][0] == 'gpwv4':
        for year in years:
            env.Command(
                    source=[config['deltas'],
                            config['pop_dens_source'][1].format(year=year)],
                    target=config['delta_pop_dens'].format(year=year, ver=''),
                    action=gis.delta_zonal_stats)

            env.Command(
                    source=[config['basins_rast'].format(ver='', ext='tif'),
                            config['pop_dens_source'][1].format(year=year)],
                    target=config['pop_dens_rast'].format(year=year, ver='', ext='tif'),
                    action=gis.regrid_to_raster,
                    method='average')

            elev_files = []
            for delta in deltas:
                env.Command(
                        source=[config['delta_map'].format(delta=delta),
                                config['pop_dens_source'][1].format(year=year)],
                        target=config['delta_pop_rast'].format(delta=delta,
                                                               year=year),
                        action=pp.clip_pop_to_delta)

                env.Command(
                        source=[config['delta_map'].format(delta=delta),
                                config['delta_srtm_rast'].format(delta=delta, srtm=config['srtm']),
                                config['delta_pop_rast'].format(delta=delta, year=year)],
                        target=config['delta_pop_elevations'].format(delta=delta, year=year),
                        action=pp.pop_elevation_bins,
                        delta=delta)
                elev_files.append(config['delta_pop_elevations'].format(delta=delta,
                                                                        year=year))

                env.Command(
                        source=config['delta_pop_elevations'].format(delta=delta, year=year),
                        target=config['delta_hypso_plot'].format(delta=delta, year=year),
                        action=pp.plot_hypsometric,
                        delta=delta)

            env.Command(
                    source=elev_files,
                    target=config['deltas_pop_elevations'].format(year=year),
                    action=pp.group_delta_pop_elevations,
                    deltas=deltas)

env.Command(
        source=None,
        target='#downloads/pop_growth_rates.xls',
        action='wget "http://esa.un.org/unpd/wpp/DVD/Files/1_Indicators%20(Standard)/EXCEL_FILES/1_Population/WPP2015_POP_F02_POPULATION_GROWTH_RATE.XLS" -O $TARGET')
