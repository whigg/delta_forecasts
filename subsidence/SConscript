# vim: set fileencoding=UTF-8 :
# vim:filetype=python

import os
import process_subsidence as ps
import gis

Import('*')

env.Command(
        source=[shared['delta_areas'],
                experiments['pristine']['Qs']],
        target=shared['natural_subsidence'],
        action=ps.steady_state_subsidence,
        eustatic_slr=experiments['pristine']['eustatic_slr'])

env.Command(
        source='/Users/ztessler/data/Groundwater_Wada2012/gwd02000.asc',
        target=shared['groundwater'].format(ver='', ext='tif'),
        action='gdal_translate -of GTiff -a_srs "epsg:4326" $SOURCE $TARGET')

env.Command(
        source=['/Users/ztessler/data/WorldPetroleumAssessment/tps_sumg/tps_sumg.shp',
                shared['deltas']],
        target=shared['oilgas'],
        action=ps.oilgas_locations)

for experiment, config in experiments.iteritems():
    # accelerated compaction:
    # groundwater
    env.Command(
            source=[shared['deltas'],
                    shared['groundwater'].format(ver='', ext='tif')],
            target=config['groundwater'].format(ver='.1', ext='pd'),
            action=gis.delta_zonal_stats)
    env.Command(
            source=config['groundwater'].format(ver='.1', ext='pd'),
            target=config['groundwater'].format(ver='', ext='pd'),
            action=ps.clean_groundwater_stats)
    env.Command(
            source=[config['groundwater'].format(ver='', ext='pd'),
                    shared['delta_areas']],
            target=config['drawdown'],
            action=ps.compute_drawdown)
    env.Command(
            source=[config['drawdown'],
                    shared['natural_subsidence']],
            target=config['groundwater_subsidence'],
            action=ps.groundwater_subsidence)

    # oil/gas
    env.Command(
            source=shared['oilgas'],
            target=config['oilgas_subsidence'],
            action=ps.oilgas_subsidence)


    # accelerated sea-level rise


