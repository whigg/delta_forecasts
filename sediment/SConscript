# vim: set fileencoding=UTF-8 :
# vim:filetype=python

import os
import process_sediment as ps

Import('*')

# convert rgis files to netCDF, use BQART model to estimate sed flux under
# different anthro conditions (including none), use to estimate natural
# subsidence rates based on sed flux, sediment retention ratio (see Syvitski and
# Saito 2007 for ratios) and delta surface area

env.Command(
        source='#data/Global/upstream_ice_percent.pd',
        target='#data/Global/bqart_I.pd',
        action=ps.compute_I)

for experiment, config in experiments.iteritems():
    if 'zeros' not in config['Te']: # don't try and build zeros file
        env.Command(
                source=[config['reservoirs'],
                        config['dis_raster'],
                        '#data/Global/basins.tif',
                        '#data/Global/upstream_basin_ids.json'],
                target=config['Te'],
                action=ps.res_trapping)

    if 'ones' not in config['Eh']: # don't try and build ones file
        env.Command(
                source=[config['gdp'],
                        config['pop']],
                target=config['Eh'],
                action=ps.compute_Eh)

    env.Command(
            source=['#data/Global/bqart_I.pd',
                    '#data/Global/upstream_lithology.pd',
                    config['Te'],
                    config['Eh']],
            target=config['B'],
            action=ps.compute_B)

    env.Command(
            source=[config['B'],
                    config['discharge'],
                    '#data/Global/upstream_areas.pd',
                    '#data/Global/upstream_relief.pd',
                    '#data/Global/upstream_temps.pd'],
            target=config['Qs'],
            action=ps.compute_Qs)

env.Command(
        source=['#data/Global/delta_areas.pd',
                experiments['pristine']['Qs']],
        target='#data/Global/natural_subsidence.pd',
        action=ps.steady_state_subsidence)
